# Wallhaven 壁纸下载器

一个基于 PyQt5 的现代化 Wallhaven 壁纸下载工具，提供美观的图形界面和高效的下载功能。

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Python](https://img.shields.io/badge/python-3.6+-green.svg)
![PyQt5](https://img.shields.io/badge/GUI-PyQt5-orange.svg)
![Platform](https://img.shields.io/badge/platform-Windows-lightgrey.svg)

## 🌟 特性

- **现代化界面**: 采用深色渐变主题，支持无边框窗口设计
- **多种下载模式**: 支持分类下载、搜索下载和最新壁纸下载
- **智能重试机制**: 内置网络错误处理和自动重试功能
- **多线程下载**: 支持并发下载，提高下载效率
- **实时进度显示**: 详细的下载进度条和日志记录
- **配置持久化**: 自动保存API密钥和下载路径设置
- **统计信息**: 实时显示成功、失败和跳过的下载数量

## 📸 界面预览

程序采用现代化的深色渐变主题，包含以下主要界面：

- **下载页面**: 选择下载模式、设置参数
- **配置页面**: 管理API密钥和下载路径
- **实时日志**: 显示详细的下载过程和统计信息

## 🚀 快速开始

### 环境要求

- Python 3.6 或更高版本
- PyQt5
- requests 库

### 安装依赖

```bash
pip install PyQt5 requests
```

### 运行程序

```bash
python test.py
```

## 📋 使用说明

### 1. 配置 API 密钥

1. 访问 [Wallhaven API 设置页面](https://wallhaven.cc/settings/account) 获取您的 API 密钥
2. 在程序的"配置"标签页中输入您的 API 密钥
3. 设置下载路径（默认为程序目录下的 Wallhaven 文件夹）
4. 点击"保存配置"

### 2. 选择下载模式

#### 分类下载

- **类别选择**: 全部、一般、动漫、人物等
- **纯度过滤**: 工作安全、可疑内容、工作不安全等
- **页数设置**: 每页约64张图片

#### 搜索下载

- 输入关键词进行搜索
- 支持英文关键词，如 "nature"、"anime" 等
- 可设置下载页数

#### 最新壁纸

- 下载热门排行榜壁纸
- 无需额外设置，直接下载

### 3. 高级设置

- **并发下载数**: 建议设置为1-3个，避免被服务器限制
- **失败重试次数**: 网络不稳定时可适当增加
- **下载页数**: 根据需求设置，每页包含64张图片

### 4. 开始下载

1. 选择下载模式并配置参数
2. 点击"开始下载"按钮
3. 实时查看下载进度和日志信息
4. 如需停止，点击"停止下载"按钮

## 🔧 技术特性

### 网络优化

- 使用 `requests.Session()` 创建持久连接
- 智能重试机制处理网络错误
- 动态速率控制，根据失败率调整下载间隔
- 支持断点续传和超时处理

### 界面特性

- 无边框窗口设计，支持自定义标题栏
- 渐变背景和现代化组件样式
- 自适应1080P分辨率显示
- 支持窗口拖拽、最小化、最大化操作

### 安全特性

- 输入验证和错误处理
- 配置信息加密存储
- 线程安全的停止机制
- 自动清理不完整下载文件

## 📁 项目结构

```
wallhevendown/
├── test.py              # 主程序文件
├── icon/                # 图标资源文件夹
│   ├── logo.ico        # 应用程序图标
│   ├── atom.ico        # 备用图标
│   ├── close.ico       # 关闭按钮图标
│   ├── minimize.ico    # 最小化按钮图标
│   └── maxmize.ico     # 最大化按钮图标
└── __pycache__/        # Python 缓存文件
```

## 🛠️ 核心组件

### ConfigManager

- 配置管理器，负责API密钥和下载路径的持久化存储
- 使用 QSettings 实现跨平台配置管理

### DownloadWorker

- 下载工作线程，负责执行实际的下载任务
- 支持多线程并发下载和智能重试机制
- 实时更新下载进度和统计信息

### WallhavenDownloader

- 主窗口类，提供完整的图形用户界面
- 标签页布局分离不同功能模块
- 自定义标题栏和窗口控制

## 🔍 API 使用

程序使用 Wallhaven 官方 API v1：

- **搜索API**: `https://wallhaven.cc/api/v1/search`
- **支持参数**: 分类、纯度、搜索关键词、排序方式等
- **认证方式**: API 密钥认证

## ⚠️ 注意事项

1. **API 限制**: 默认API密钥有使用限制，建议使用个人API密钥
2. **网络稳定性**: 下载失败通常由网络不稳定引起，可增加重试次数
3. **并发限制**: 建议并发数不超过3个，避免被服务器限制
4. **存储空间**: 高分辨率图片占用空间较大，注意磁盘空间

## 🐛 常见问题

### Q: 下载失败率较高怎么办？

A: 

- 检查网络连接是否稳定
- 增加重试次数设置
- 降低并发下载数
- 稍后重试下载

### Q: 无法启动程序？

A: 

- 确认 Python 版本（需要3.6+）
- 安装必要依赖：`pip install PyQt5 requests`
- 检查是否缺少图标文件

### Q: API密钥无效？

A: 

- 确认在 Wallhaven 官网正确获取API密钥
- 检查密钥是否复制完整
- 确认账户状态正常

## 📄 更新日志

### 当前版本特性

- ✅ 现代化PyQt5图形界面
- ✅ 多种下载模式支持
- ✅ 智能重试和错误处理
- ✅ 配置持久化存储
- ✅ 实时进度和统计显示
- ✅ 线程安全的停止机制

### 未来计划

- 🔄 添加主题切换功能
- 🔄 支持更多图片格式
- 🔄 添加下载历史记录
- 🔄 支持批量管理功能

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

## 📜 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🙏 致谢

- [Wallhaven](https://wallhaven.cc/) - 提供优质的壁纸资源和API
- [PyQt5](https://www.riverbankcomputing.com/software/pyqt/) - 强大的GUI框架
- [Requests](https://docs.python-requests.org/) - 优雅的HTTP库

---

⭐ 如果这个项目对您有帮助，请给个星标支持！
